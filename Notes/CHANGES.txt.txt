================================================================================
                    CM3020 AI COURSEWORK - CHANGELOG
                    Bug Fixes and Improvements
================================================================================

Date: 2024-12-24
Version: 2.0 (Major Bug Fix Release)

================================================================================
CRITICAL BUG FIXES
================================================================================

1. JOINT LIMITS CORRECTED (genome.py:316-317)
   -------------------------------------------------------------------------
   Problem: URDF joint limits were backwards (upper < lower)
   Impact:  PyBullet joint behavior was erratic/undefined

   Before:
       limit_tag.setAttribute("upper", "-3.1415")
       limit_tag.setAttribute("lower", "3.1415")

   After:
       limit_tag.setAttribute("upper", "3.1415")
       limit_tag.setAttribute("lower", "-3.1415")

2. FLOATING LIMBS FIXED (genome.py:325-333)
   -------------------------------------------------------------------------
   Problem: Joint origins could be placed up to 1 unit away from parent link
   Impact:  Limbs appeared detached/floating, creatures were physically broken

   Before:
       xyz = str(self.joint_origin_xyz_1) + " " + ...

   After:
       # Position joint at end of parent link
       xyz_1 = self.link_length * 0.5 + self.joint_origin_xyz_1 * 0.1
       xyz_2 = self.joint_origin_xyz_2 * 0.1
       xyz_3 = self.joint_origin_xyz_3 * 0.1

3. MUTATION AMOUNT PARAMETER NOW USED (genome.py:130-131)
   -------------------------------------------------------------------------
   Problem: point_mutate() ignored the 'amount' parameter, used hardcoded 0.1
   Impact:  Mutation experiments were invalid; tuning had no effect

   Before:
       gene[i] += random.uniform(-0.1, 0.1)  # Hardcoded!

   After:
       gene[i] += random.uniform(-amount, amount)  # Uses parameter

4. MOTOR AMPLITUDE STANDARDIZED (creature.py:16-18, 34)
   -------------------------------------------------------------------------
   Problem: Amplitude gene existed but was never applied to motor output
   Impact:  Motor strength was inconsistent with DNA encoding

   Before:
       self.amp = control_amp  # Stored but never used
       return output           # Raw output returned

   After:
       self.amp = 1.0          # Constant for fair testing
       return output * self.amp

5. JOINT TYPE DEAD CODE REMOVED (genome.py:301-304)
   -------------------------------------------------------------------------
   Problem: Both if/else branches set joint type to "revolute"
   Impact:  Wasted code, confusing logic

   Before:
       if self.joint_type >= 0.5:
           joint_tag.setAttribute("type", "revolute")
       else:
           joint_tag.setAttribute("type", "revolute")  # Same!

   After:
       # All joints are revolute type for consistent behavior
       joint_tag.setAttribute("type", "revolute")

================================================================================
HIGH-PRIORITY FIXES
================================================================================

6. MINIMUM LINK SIZES ENFORCED (genome.py:245-249)
   -------------------------------------------------------------------------
   Problem: Links could be near-zero size, causing physics instability
   Impact:  Microscopic/invisible links, simulation crashes

   Added:
       min_length = 0.1
       min_radius = 0.05
       actual_length = max(self.link_length, min_length)
       actual_radius = max(self.link_radius, min_radius)

7. PROPER INERTIA CALCULATION (genome.py:281-293)
   -------------------------------------------------------------------------
   Problem: Inertia was hardcoded to 0.03 regardless of link size
   Impact:  Unrealistic physics, tiny links too hard to rotate

   Before:
       inertia_tag.setAttribute("ixx", "0.03")  # Hardcoded
       inertia_tag.setAttribute("iyy", "0.03")
       inertia_tag.setAttribute("izz", "0.03")

   After:
       # Calculate proper inertia for a solid cylinder
       # Ixx = Iyy = (1/12) * m * (3*r^2 + h^2)
       # Izz = (1/2) * m * r^2
       ixx = (1.0/12.0) * mass * (3 * actual_radius**2 + actual_length**2)
       iyy = ixx
       izz = (1.0/2.0) * mass * actual_radius**2

8. RECURRENCE SCALE REDUCED (genome.py:21)
   -------------------------------------------------------------------------
   Problem: link-recurrence scale of 3 created 1-4 copies per link
   Impact:  Overly complex creatures, hard to evolve functional designs

   Before:
       "link-recurrence": {"scale":3}  # 1-4 copies

   After:
       "link-recurrence": {"scale":2}  # 1-3 copies

9. SHALLOW COPY BUG FIXED (genome.py:125-163)
   -------------------------------------------------------------------------
   Problem: copy.copy() created shallow copies, mutations corrupted parents
   Impact:  Parent DNA was modified when children mutated

   Before:
       new_genome = copy.copy(genome)  # Shallow copy!

   After:
       new_genome = [gene.copy() for gene in genome]  # Deep copy

   Applied to: point_mutate(), shrink_mutate(), grow_mutate()

10. MOTOR FORCE INCREASED (simulation.py:66)
    -------------------------------------------------------------------------
    Problem: Motor force of 5N was too weak for climbing against gravity
    Impact:  Creatures couldn't generate enough torque to climb

    Before:
        force = 5

    After:
        force = 10  # Increased for better climbing ability

11. SPAWN DISTANCE CORRECTED (creature.py:153-154, 167-168)
    -------------------------------------------------------------------------
    Problem: Code referenced spawn at (-7.8, 0) but actual spawn is (5, 0, 3)
    Impact:  Proximity fitness calculation was wrong

    Before:
        return 7.8  # Wrong distance
        return max(0, 7.8 - distance)

    After:
        return 5.0  # Correct distance from (5, 0, 3) to (0, 0)
        return max(0, 5.0 - distance)

================================================================================
SUMMARY OF FILES CHANGED
================================================================================

genome.py:
  - Line 21: Reduced recurrence scale from 3 to 2
  - Lines 125-163: Fixed shallow copy in all mutation functions
  - Lines 245-249: Added minimum link size enforcement
  - Lines 281-293: Implemented proper inertia calculation
  - Lines 301-304: Removed dead joint type code
  - Lines 316-317: Fixed joint limits (swapped upper/lower)
  - Lines 325-333: Fixed joint origin to prevent floating limbs

creature.py:
  - Lines 16-18: Hardcoded motor amplitude to 1.0
  - Line 34: Motor now returns output * self.amp
  - Lines 153-154: Fixed spawn distance to 5.0
  - Lines 167-168: Fixed proximity score calculation

simulation.py:
  - Line 66: Increased motor force from 5 to 10

================================================================================
EXPECTED IMPROVEMENTS
================================================================================

After these fixes, you should observe:
1. Creatures with connected limbs (no floating parts)
2. More stable physics simulation
3. Simpler creature structures (fewer runaway link expansions)
4. Proper mutation behavior (tunable via amount parameter)
5. Better climbing ability due to increased motor force
6. Accurate fitness calculations based on actual spawn position

================================================================================
END OF CHANGELOG
================================================================================
