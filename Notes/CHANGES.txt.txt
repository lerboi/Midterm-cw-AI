================================================================================
                        COURSEWORK PART B - CHANGES LOG
                    Mountain Climbing Genetic Algorithm
================================================================================

This file documents ALL changes made to the original codebase to adapt it
for the mountain climbing task in Part B of the coursework.

Each entry contains:
1. HIGH-LEVEL SUMMARY - What was changed and why
2. FUNCTION-LEVEL DESCRIPTIONS - Which functions/methods were added/modified
3. LINE-BY-LINE CODE CHANGES - Actual code snippets showing modifications

================================================================================
CHANGE #1: Added Height Tracking to Creature Class
Date: 2024-12-14
File: creature.py
Reason: Need to track maximum height achieved for mountain climbing fitness
        instead of horizontal distance traveled
================================================================================

HIGH-LEVEL SUMMARY:
- Added max_height attribute to Creature class to track the highest z-coordinate
  reached during simulation
- Added method to update maximum height whenever creature position is updated
- Added method to retrieve final maximum height for fitness calculation
- Modified update_dna() to reset max_height when DNA is updated

FUNCTION-LEVEL CHANGES:

1. Modified __init__(self, gene_count)
   - Added: self.max_height = 0
   - Purpose: Initialize maximum height tracking at zero

2. Added update_max_height(self, pos)
   - New method to update max_height if current z-coordinate is higher
   - Called during simulation whenever position is updated
   
3. Added get_max_height(self)
   - New method to return the maximum height achieved
   - Used as fitness function for mountain climbing

4. Modified update_dna(self, dna)
   - Added: self.max_height = None
   - Purpose: Reset max_height when creature DNA is updated for next generation

LINE-BY-LINE CODE CHANGES:

LOCATION: creature.py, class Creature, __init__ method
BEFORE (line ~33):
        self.motors = None
        self.start_position = None
        self.last_position = None

AFTER:
        self.motors = None
        self.start_position = None
        self.last_position = None
        self.max_height = 0  # NEW: Track maximum height for mountain climbing

---

LOCATION: creature.py, class Creature, new method after update_position
NEW METHOD ADDED (after line ~58):
    def update_max_height(self, pos):
        """
        Update the maximum height achieved by the creature.
        This is used for mountain climbing fitness.
        
        Args:
            pos: tuple of (x, y, z) coordinates
        """
        if pos is not None and len(pos) >= 3:
            current_height = pos[2]  # z-coordinate is height
            if current_height > self.max_height:
                self.max_height = current_height

---

LOCATION: creature.py, class Creature, new method after update_max_height
NEW METHOD ADDED:
    def get_max_height(self):
        """
        Get the maximum height achieved by the creature.
        Used as fitness function for mountain climbing.
        
        Returns:
            float: Maximum z-coordinate reached during simulation
        """
        return self.max_height

---

LOCATION: creature.py, class Creature, update_dna method
BEFORE (line ~68):
        self.motors = None
        self.start_position = None
        self.last_position = None

AFTER:
        self.motors = None
        self.start_position = None
        self.last_position = None
        self.max_height = 0  # NEW: Reset max height for new DNA

================================================================================
END OF CHANGE #1
================================================================================


================================================================================
CHANGE #2: Modified Simulation for Mountain Climbing
Date: 2024-12-14
File: simulation.py (MODIFIED)
Reason: Need to replace flat plane environment with mountain terrain for
        mountain climbing task and track maximum height instead of distance
================================================================================

HIGH-LEVEL SUMMARY:
- Modified existing simulation.py file to support mountain climbing
- Replaced flat plane environment with arena + mountain setup from cw-envt.py
- Added helper functions to create arena walls and load mountain
- Modified run_creature() to track max height during simulation
- Modified run_creature() to call update_max_height() on creatures
- Set additional search path for loading mountain URDF files from shapes/ folder

FUNCTION-LEVEL CHANGES:

1. Added make_arena(arena_size, wall_height, physicsClientId)
   - New helper function at end of file
   - Creates sandbox arena with floor and four walls
   - Returns floor body ID
   
2. Added load_mountain(mountain_file, position, orientation, physicsClientId)
   - New helper function at end of file
   - Loads mountain URDF file from shapes/ directory
   - Returns mountain body ID

3. Modified run_creature(self, cr, iterations)
   - Replaced plane creation with arena + mountain setup
   - Added search path for shapes/ directory
   - Added call to cr.update_max_height(pos) during simulation loop
   - Changed starting position from [0, 0, 2.5] to [0, 0, 10]

4. Kept update_motors() unchanged
   - No changes needed for motor control

5. Kept eval_population() unchanged
   - No changes needed for population evaluation

6. ThreadedSim class kept unchanged
   - Works with the new simulation automatically

LINE-BY-LINE CODE CHANGES:

LOCATION: simulation.py, class Simulation, run_creature method
BEFORE (lines ~13-15):
        p.setGravity(0, 0, -10, physicsClientId=pid)
        plane_shape = p.createCollisionShape(p.GEOM_PLANE, physicsClientId=pid)
        floor = p.createMultiBody(plane_shape, plane_shape, physicsClientId=pid)

AFTER:
        p.setGravity(0, 0, -10, physicsClientId=pid)
        
        # Create arena and mountain environment instead of flat plane
        arena_size = 20
        make_arena(arena_size=arena_size, wall_height=1, physicsClientId=pid)
        
        # Set search path for mountain URDF files
        p.setAdditionalSearchPath('shapes/', physicsClientId=pid)
        
        # Load mountain
        mountain_position = (0, 0, -1)
        mountain_orientation = p.getQuaternionFromEuler((0, 0, 0))
        load_mountain("gaussian_pyramid.urdf", mountain_position, mountain_orientation, physicsClientId=pid)

---

LOCATION: simulation.py, class Simulation, run_creature method
BEFORE (line ~23):
        p.resetBasePositionAndOrientation(cid, [0, 0, 2.5], [0, 0, 0, 1], physicsClientId=pid)

AFTER:
        # Start creature at height 10 to drop onto mountain
        p.resetBasePositionAndOrientation(cid, [0, 0, 10], [0, 0, 0, 1], physicsClientId=pid)

---

LOCATION: simulation.py, class Simulation, run_creature method
BEFORE (lines ~30-33):
            pos, orn = p.getBasePositionAndOrientation(cid, physicsClientId=pid)
            cr.update_position(pos)
            #print(pos[2])
            #print(cr.get_distance_travelled())

AFTER:
            pos, orn = p.getBasePositionAndOrientation(cid, physicsClientId=pid)
            cr.update_position(pos)
            cr.update_max_height(pos)  # Track maximum height for mountain climbing

---

LOCATION: simulation.py, end of file (after ThreadedSim class)
NEW HELPER FUNCTIONS ADDED:

(See full code in next section)

================================================================================
END OF CHANGE #2
================================================================================


================================================================================
CHANGE #3: Created Mountain Climbing GA Test Script
Date: 2024-12-14
File: test_ga_mountain.py (NEW FILE)
Reason: Need a GA script that uses get_max_height() as fitness function instead
        of get_distance_travelled() for mountain climbing evolution
================================================================================

HIGH-LEVEL SUMMARY:
- Created new file test_ga_mountain.py based on test_ga_no_threads.py
- Modified fitness evaluation to use get_max_height() instead of get_distance_travelled()
- Changed elite creature filename to "elite_mountain_" prefix
- Kept same GA parameters (population size, gene count, mutation rates)
- Kept same structure: population creation, simulation, selection, crossover, mutation, elitism

FUNCTION-LEVEL CHANGES:

1. Modified testBasicGA() method
   - Changed fitness calculation from cr.get_distance_travelled() to cr.get_max_height()
   - Changed print statement to show "max height" instead of "fittest"
   - Changed elite filename from "elite_" to "elite_mountain_"
   - All other GA logic remains identical

2. No changes to:
   - Population creation (pop_size=10, gene_count=3)
   - Simulation setup (Simulation() class)
   - Selection process (get_fitness_map, select_parent)
   - Crossover and mutation (same rates)
   - Elitism implementation

LINE-BY-LINE CODE CHANGES:

LOCATION: test_ga_mountain.py (NEW FILE)
This is based on test_ga_no_threads.py with minimal changes.

BEFORE (from test_ga_no_threads.py, line ~23):
            fits = [cr.get_distance_travelled() 
                    for cr in pop.creatures]

AFTER:
            fits = [cr.get_max_height() 
                    for cr in pop.creatures]

---

BEFORE (from test_ga_no_threads.py, line ~27):
            print(iteration, "fittest:", np.round(np.max(fits), 3), 
                  "mean:", np.round(np.mean(fits), 3), "mean links", np.round(np.mean(links)), "max links", np.round(np.max(links)))

AFTER:
            print(iteration, "max height:", np.round(np.max(fits), 3), 
                  "mean:", np.round(np.mean(fits), 3), "mean links", np.round(np.mean(links)), "max links", np.round(np.max(links)))

---

BEFORE (from test_ga_no_threads.py, line ~44):
            max_fit = np.max(fits)
            for cr in pop.creatures:
                if cr.get_distance_travelled() == max_fit:
                    new_cr = creature.Creature(1)
                    new_cr.update_dna(cr.dna)
                    new_creatures[0] = new_cr
                    filename = "elite_"+str(iteration)+".csv"
                    genome.Genome.to_csv(cr.dna, filename)
                    break

AFTER:
            max_fit = np.max(fits)
            for cr in pop.creatures:
                if cr.get_max_height() == max_fit:
                    new_cr = creature.Creature(1)
                    new_cr.update_dna(cr.dna)
                    new_creatures[0] = new_cr
                    filename = "elite_mountain_"+str(iteration)+".csv"
                    genome.Genome.to_csv(cr.dna, filename)
                    break

================================================================================
END OF CHANGE #3
================================================================================